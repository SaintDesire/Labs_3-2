<html>
<body>
<form action="/" method="get">
  <label htmlFor="gameTitle">Game Title:</label>
  <input type="text" id="gameTitle" name="gameTitle" required>
  <button type="submit">Search</button>
</form>
<div id="gameInfo" style="display: flex; flex-wrap: wrap;"></div>

<div id="gameInfoList" style="display: flex; flex-wrap: wrap;"></div>

<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    fetch('/gamesList')
            .then(response => response.json())
            .then(data => {
              if (data.error) {
                console.error('Error:', data.error);
              } else {
                const gameInfo = document.getElementById('gameInfo');
                data.games.forEach(game => {
                  const gameElement = document.createElement('div');
                  const gameTitle = document.createElement('p');

                  gameTitle.textContent = game.gameTitle;

                  gameElement.classList.add('game');
                  gameElement.style.border = '1px solid black';
                  gameElement.style.padding = '15px';
                  gameElement.appendChild(gameTitle);

                  const lastImage = game.image;
                  if (lastImage) {
                    const gameImage = document.createElement('img');
                    gameImage.src = lastImage;
                    gameImage.alt = 'Game Image';
                    gameImage.style.width = '200px';
                    gameImage.style.height = '200px';
                    gameImage.style.margin = '10px';
                    gameImage.style.border = '1px solid black';
                    gameElement.appendChild(gameImage);
                  }

                  gameInfo.appendChild(gameElement);
                });
              }
            })
            .catch(error => {
              console.error('Error:', error);
            });
  });
  const form = document.querySelector('form');
  const gameTitleInput = document.querySelector('#gameTitle');
  const gameInfoDiv = document.querySelector('#gameInfo');

  form.addEventListener('submit', (event) => {
    event.preventDefault();
    const gameTitle = gameTitleInput.value;

    fetch('/game?gameTitle=' + encodeURIComponent(gameTitle))
            .then((response) => response.json())
            .then((data) => {
              gameInfoDiv.innerHTML = '';
              if (data.error) {
                gameInfoDiv.textContent = data.error;
              } else {
                const images = data.images;
                images.forEach((imageUrl, index) => {
                  const imageElement = document.createElement('img');
                  imageElement.src = imageUrl;
                  imageElement.style.width = '200px';
                  imageElement.style.height = '200px';
                  imageElement.style.margin = '10px';
                  gameInfoDiv.appendChild(imageElement);
                });
              }
            })
            .catch((error) => {
              gameInfoDiv.textContent = 'An error occurred';
              console.error('Error:', error);
            });
  });

  gameTitleInput.addEventListener('input', (event) => {
    const input = event.target;
    const inputValue = input.value;

    if (inputValue.length >= 3) {
      fetch('/search?gameTitle=' + encodeURIComponent(inputValue))
              .then((response) => response.json())
              .then((data) => {
                const searchResults = data.games;
                const suggestionsDiv = document.createElement('div');
                suggestionsDiv.id = 'suggestionsDiv';
                suggestionsDiv.style.display = 'flex';
                suggestionsDiv.style.flexWrap = 'wrap';
                suggestionsDiv.style.marginTop = '10px';
                searchResults.forEach((game) => {
                  const suggestion = document.createElement('div');
                  suggestion.textContent = game.title;
                  suggestion.classList.add('suggestion');
                  suggestion.style.padding = '5px';
                  suggestion.style.margin = '5px';
                  suggestion.style.border = '1px solid black';
                  suggestion.addEventListener('click', () => {
                    gameTitleInput.value = game.title;
                    suggestionsDiv.remove();
                    form.dispatchEvent(new Event('submit'));
                  });
                  suggestionsDiv.appendChild(suggestion);
                });

                const existingSuggestionsDiv = document.querySelector('#suggestionsDiv');
                if (existingSuggestionsDiv) {
                  existingSuggestionsDiv.replaceWith(suggestionsDiv);
                } else {
                  form.appendChild(suggestionsDiv);
                }
              })
              .catch((error) => {
                console.error('Error:', error);
              });
    } else {
      const suggestionsDiv = document.querySelector('#suggestionsDiv');
      if (suggestionsDiv) {
        suggestionsDiv.remove();
      }
    }
  });

  document.addEventListener('click', (event) => {
    const suggestionsDiv = document.querySelector('#suggestionsDiv');
    if (event.target !== gameTitleInput && event.target !== suggestionsDiv) {
      if (suggestionsDiv) {
        suggestionsDiv.remove();
      }
    }
  });
</script>
</body>
</html>